<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lobby - {{ room_id }}</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">

<div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-lg">
    <h1 class="text-2xl font-bold mb-2">Lobby: {{ room_id }}</h1>
    <p class="mb-4 font-medium">You are: {{ player_name }}</p>

    <div id="players" class="mb-4">
        <h2 class="font-semibold">Connected Players:</h2>
        <ul id="player-list"></ul>
    </div>

    <div class="mb-4 flex gap-2">
        <button id="copy-room-id" class="p-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">
            Copy Room ID
        </button>
        <button id="start-game" class="p-2 bg-green-500 text-white rounded hover:bg-green-600 transition">
            Start Game
        </button>
        <button id="enter-room" class="p-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition">
            Enter Room
        </button>
    </div>
    
    <div id="error-message" class="hidden bg-red-100 text-red-700 p-3 rounded mb-4"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const socket = io();
    const roomId = "{{ room_id }}";
    const playerName = "{{ player_name }}";
    const playerList = document.getElementById('player-list');
    const errorMsg = document.getElementById('error-message');

    socket.emit('join_room', { room_id: roomId, player_name: playerName });

    socket.on('update_players', data => {
        playerList.innerHTML = '';
        data.players.forEach(p => {
            const li = document.createElement('li');
            li.textContent = p;
            li.className = 'p-2 border-b';
            playerList.appendChild(li);
        });
    });

    socket.on('error', data => {
        errorMsg.textContent = data.message;
        errorMsg.classList.remove('hidden');
        setTimeout(() => errorMsg.classList.add('hidden'), 5000);
    });

    socket.on('game_started', () => {
        // Redirect to game room
        window.location.href = `/room/${roomId}?player=${encodeURIComponent(playerName)}`;
    });

    // Copy room ID button
    document.getElementById('copy-room-id').addEventListener('click', () => {
        navigator.clipboard.writeText(roomId).then(() => {
            alert("Room ID copied: " + roomId);
        });
    });

    // Start game button
    document.getElementById('start-game').addEventListener('click', () => {
        socket.emit('start_game', { room_id: roomId });
    });

    // Enter room button
    document.getElementById('enter-room').addEventListener('click', () => {
        window.location.href = `/room/${roomId}?player=${encodeURIComponent(playerName)}`;
    });
});
</script>
</body>
</html>
